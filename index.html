<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SmokeLess â€” Personal Smoking Tracker</title>
  <meta name="description" content="Track your smoking, build a taper plan, and quit within 3 months." />
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <h1>ðŸš­ SmokeLess</h1>
    <div class="header-actions">
      <label class="theme-label">Theme
        <select id="themeSwitch">
          <option value="system">System</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </label>
    </div>
    <nav class="tabs" role="tablist">
      <button class="tab-btn" data-tab="dashboard" aria-selected="false">Dashboard</button>
      <button class="tab-btn active" data-tab="log" aria-selected="true">Log</button>
      <button class="tab-btn" data-tab="history">History</button>
      <button class="tab-btn" data-tab="plan">Plan</button>
      <button class="tab-btn" data-tab="data">Data</button>
    </nav>
  </header>

  <!-- Toasts -->
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <main>
    <!-- DASHBOARD -->
    <section id="dashboard" class="tab-panel" aria-labelledby="Dashboard">
      <div id="cardsContainer" class="cards">
        <div class="card card-today" draggable="true" data-card="today">
          <h3>Today</h3>
          <p class="muted">Cigarettes logged</p>
          <div class="metric"><span id="todayCount">0</span></div>
          <div class="meta">
            <span>Limit: <strong id="todayLimit">â€”</strong></span>
            <span>Remaining: <strong id="remaining">â€”</strong></span>
          </div>
          <div class="row">
            <button id="quickLog1" class="btn primary">+ Log 1</button>
            <button id="undoLast" class="btn">Undo last</button>
          </div>
        </div>

        <div class="card card-trend" draggable="true" data-card="trend">
          <h3>7â€‘Day Trend</h3>
          <div id="sparkline" class="sparkline" aria-label="Last 7 days bar sparkline"></div>
          <p class="muted" id="weeklySummary"></p>
        </div>

        <div class="card card-money" draggable="true" data-card="money">
          <h3>Money</h3>
          <p class="muted">Estimated spend this month</p>
          <div class="metric"> <span id="moneySpent">â‚¹0</span></div>
          <p class="muted">vs baseline you could be saving <strong id="moneySaved">â‚¹0</strong></p>
          <p class="muted">Craving savings (this month) <strong id="moneyCravingSaved">â‚¹0</strong></p>
          <p class="muted">Total craving savings (to date) <strong id="moneyCravingSavedTotal">â‚¹0</strong></p>
        </div>

        <!-- CRAVING TIMER -->
        <div class="card card-timer" draggable="true" data-card="timer">
          <h3>Craving Timer</h3>
          <div class="timer">
            <div class="timer-display" id="timerDisplay">10:00</div>
            <div class="grid-2">
              <label>Craving intensity (1â€“5)
                <select id="cravingIntensity">
                  <option>1</option>
                  <option>2</option>
                  <option selected>3</option>
                  <option>4</option>
                  <option>5</option>
                </select>
              </label>
              <label>Optional note
                <input type="text" id="cravingNote" placeholder="e.g., after coffee" />
              </label>
            </div>
            <div class="row">
              <button id="timerStart" class="btn primary">Start</button>
              <button id="timerDelay5" class="btn">Delay 5 min</button>
              <button id="timerPause" class="btn">Pause</button>
              <button id="timerReset" class="btn">Reset</button>
            </div>
            <p class="muted" id="timerTip">Tip: Take 10 slow breathsâ€”in through the nose, out through the mouth.</p>
          </div>
        </div>

        <!-- STREAKS & BADGES (live) -->
        <div class="card card-streaks" draggable="true" data-card="streaks">
          <h3>Streaks & Badges</h3>
          <div class="streaks">
            <div>Withinâ€‘limit streak: <strong id="streakWithin">0</strong> days</div>
            <div>Zeroâ€‘day streak: <strong id="streakZero">0</strong> days</div>
            <div>Weekly change: <strong id="weeklyChange">â€”</strong></div>
          </div>
          <div class="badges-list" id="badgesList"></div>
        </div>

        <!-- BADGES GALLERY with filter -->
        <div class="card card-gallery" draggable="true" data-card="gallery">
          <h3>Badges Gallery</h3>
          <div class="row wrap" id="badgesFilter" style="gap:8px; margin-bottom:8px;">
            <button class="chip" data-cat="all">All</button>
            <button class="chip" data-cat="streaks">Streaks</button>
            <button class="chip" data-cat="timer">Timer</button>
            <button class="chip" data-cat="savings">Savings</button>
          </div>
          <div id="badgesGallery" class="badges-gallery"></div>
        </div>

        <!-- 30-DAY LINE CHART -->
        <div class="card card-linechart" draggable="true" data-card="linechart">
          <h3>30â€‘Day Line Chart</h3>
          <canvas id="chart30" class="chart" width="640" height="260" aria-label="30 day line chart"></canvas>
          <p class="muted">Counts per day (blue). Daily limit (gray).</p>
        </div>

        <!-- TRIGGERS HEATMAP (HOURS Ã— TRIGGERS) -->
        <div class="card card-heatmap" draggable="true" data-card="heatmap">
          <h3>Triggers Heatmap (Hours Ã— Triggers, Last 30 days)</h3>
          <canvas id="heatmap" class="heatmap" width="640" height="340" aria-label="Triggers heatmap hours by triggers"></canvas>
          <p class="muted">Rows = triggers, Columns = hours (0â€“23). Darker = more logs.</p>
        </div>
      </div>
    </section>

    <!-- LOG (default) -->
    <section id="log" class="tab-panel active" aria-labelledby="Log">
      <form id="logForm" class="card form">
        <h3>Log a cigarette</h3>
        <div class="grid-2">
          <label>Count
            <input type="number" id="count" min="1" value="1" required />
          </label>
          <label>Time
            <input type="datetime-local" id="when" />
          </label>
        </div>
        <div class="grid-2">
          <label>Trigger
            <select id="triggerSelect"></select>
          </label>
          <label>Mood
            <select id="mood">
              <option value="">â€” choose â€”</option>
              <option>Calm</option>
              <option>Neutral</option>
              <option>Stressed</option>
              <option>Anxious</option>
              <option>Happy</option>
            </select>
          </label>
        </div>
        <label>Notes
          <textarea id="note" rows="2" placeholder="Anything notable (time, place, craving level)â€¦"></textarea>
        </label>
        <div class="row end">
          <button type="submit" id="logSaveBtn" class="btn primary">Save</button>
        </div>
        <p class="muted" id="loggingDisabledMsg" style="display:none">Logging is temporarily disabled while the craving timer is running.</p>
      </form>

      <div class="card">
        <h3>Quick actions</h3>
        <div id="chipsRow" class="row wrap"></div>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="history" class="tab-panel" aria-labelledby="History">
      <div class="card">
        <h3>Recent entries</h3>
        <div id="historyList" class="list"></div>
      </div>
    </section>

    <!-- PLAN -->
    <section id="plan" class="tab-panel" aria-labelledby="Plan">
      <div class="card form">
        <h3>3â€‘Month Quit Plan</h3>
        <div class="grid-2">
          <label>Baseline daily average (cigs/day)
            <input type="number" id="baseline" min="1" placeholder="e.g., 12" />
          </label>
          <label>Quit date
            <input type="date" id="quitDate" />
          </label>
        </div>
        <div class="grid-2">
          <label>Cost per pack
            <input type="number" id="costPerPack" min="0" step="0.01" placeholder="e.g., 150" />
          </label>
          <label>Cigs per pack
            <input type="number" id="cigsPerPack" min="1" placeholder="e.g., 20" />
          </label>
        </div>
        <div class="grid-2">
          <label>Craving timer (minutes)
            <input type="number" id="timerMinutes" min="1" step="1" placeholder="e.g., 10" />
          </label>
        </div>
        <div class="row end">
          <button id="generatePlan" class="btn">Generate/Update Plan</button>
          <button id="clearPlan" class="btn danger">Clear Plan</button>
        </div>
      </div>

      <div class="card form">
        <h3>Triggers</h3>
        <label>Current triggers
          <select id="planTriggersSelect" multiple size="6"></select>
        </label>
        <div id="planTriggersEditor"></div>
        <div class="row" style="margin-top:8px; gap:8px;">
          <input id="planNewTrigger" type="text" placeholder="Add new trigger" />
          <button id="planAddTriggerBtn" class="btn">Add</button>
        </div>
        <p class="muted">Tip: Tailor triggers to your habits. This updates the Log dropdown and quick chips.</p>
      </div>

      <div class="card">
        <h3>Daily Limits (next 90 days)</h3>
        <div id="planGrid" class="plan-grid"></div>
      </div>
    </section>

    <!-- DATA -->
    <section id="data" class="tab-panel" aria-labelledby="Data">
      <div class="card form">
        <h3>Export / Import</h3>
        <div class="grid-2">
          <div>
            <p class="muted">Download your data as JSON or CSV.</p>
            <div class="row">
              <button id="exportJson" class="btn">Export JSON</button>
              <button id="exportCsv" class="btn">Export CSV</button>
            </div>
          </div>
          <div>
            <label class="file">
              <span>Import JSON/CSV</span>
              <input type="file" id="importFile" accept=".json,.csv" />
            </label>
            <p class="muted">Import merges with existing data. Duplicates by id are ignored.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>Made for you to take back control. Data stays on your device.</small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
